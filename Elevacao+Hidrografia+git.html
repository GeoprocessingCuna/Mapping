title: "Elevation and Hydrology Map"
author: "Inacio Cuna"
date: "2025-09-10"
output:
  pdf_document: default
  html_document: default
#############################
knitr::opts_chunk$set(echo = TRUE)
options(encoding = "UTF-8")
# On Windows, ensure a compatible locale:
if (.Platform$OS.type == "windows") {
  # use the available one; if it fails, not critical
  try(Sys.setlocale("LC_CTYPE", "Portuguese_Brazil.1252"), silent = TRUE)
}
##############################################################################
Introduction

The elaboration of maps that combine relief and hydrography is essential to understand the relationship between altitude, watercourses, and land use. In the case of Mozambique, such information supports agriculture, water management, and disaster prevention. This work describes, in a didactic way, the steps for building a clear and accessible map, avoiding the use of very large datasets so that it can be processed on personal computers.

Objectives

Represent Mozambique’s altitude in intuitive color classes.

Map rivers, lakes, reservoirs, dams, and dikes using open datasets.

Ensure visual clarity so that anyone can understand the map.

Work with smaller data subsets, avoiding heavy and slow files.

Methodology
#############
1. Load packages
################
# Spatial data handling
library(terra)            # raster (altitude, contours)
library(sf)               # vectors
library(dplyr)            # table manipulation
library(tmap)             # cartographic visualization
library(rnaturalearth)    # global data (rivers, lakes, cities)
library(geodata)          # relief and administrative boundaries
############################
2. Data acquisition

Digital elevation model (~1 km)
moz <- elevation_30s(country = "Moz", path = tempdir())


Administrative boundaries (level 1 = provinces)
#####################################
moz_adm1 <- geodata::gadm(country = "MOZ", level = 1, path = tempdir())
moz_adm1 <- st_as_sf(moz_adm1) |> st_transform(4326)


National boundary (union of provinces)
##########################################
moz_border <- moz_adm1 |> st_union()


Basic hydrography (Natural Earth)
#############################################
rios <- ne_download(scale = 10, type = "rivers_lake_centerlines",
                    category = "physical", returnclass = "sf") |> st_transform(4326)
lagos <- ne_download(scale = 10, type = "lakes",
                     category = "physical", returnclass = "sf") |> st_transform(4326)


Clip to Mozambique
#########################
rios_moz  <- st_intersection(rios, moz_border)
lagos_moz <- suppressWarnings(st_intersection(st_make_valid(lagos), moz_border))
############################################################################################################################################

3. Preparation and filtering
##############################
Separate main rivers (largest lengths)
####
rios_moz <- dplyr::mutate(rios_moz, .id_rio = dplyr::row_number())
if ("scalerank" %in% names(rios_moz)) {
  # if the column exists, use it (<= 4 is usually “main” in NE)
  rios_principais <- dplyr::filter(rios_moz, scalerank <= 4)
} else {
  # fallback: top 15% by length
  comp <- as.numeric(sf::st_length(rios_moz))
  thr  <- stats::quantile(comp, 0.85, na.rm = TRUE)
  rios_principais <- rios_moz[comp >= thr, , drop = FALSE]
}

if (nrow(rios_principais) > 0) {
  ids_princ    <- rios_principais$.id_rio
  rios_menores <- dplyr::filter(rios_moz, !.id_rio %in% ids_princ)
} else {
  # extreme case: if no “main” rivers, all are “minor”
  rios_menores <- rios_moz
}


Other rivers
###############
rios_moz <- dplyr::mutate(rios_moz, .id_rio = dplyr::row_number())
rios_menores <- dplyr::filter(rios_moz, !.id_rio %in% ids_princ)

#########################################################################################################################################
4. Cartographic representation
############################
tmap_mode("plot")

# Altitude palette (green → brown → white)
  ######################################
pal_alt <- c("#d9f0a3", "#addd8e", "#78c679",
             "#41ab5d", "#238443", "#006837",
             "#fee08b", "#fdae61", "#f46d43", "#d73027", "#a50026")


Altitude intervals
#####################
rng  <- unlist(terra::global(moz, "range", na.rm = TRUE))
brks <- seq(floor(rng[1]/500)*500, ceiling(rng[2]/500)*500, by = 500)


Map construction
##################
mapa <- tm_shape(moz) +
  tm_raster(col.scale  = tm_scale(values = pal_alt, breaks = brks),
            col.legend = tm_legend(title = "Altitude (m)")) +

  tm_shape(moz_adm1) + tm_borders(lwd = 1.1, col = "black") +
  tm_text("NAME_1", size = 0.6, col = "black",
          bg.color = "white", bg.alpha = 0.7) +

  tm_shape(lagos_moz) + tm_polygons(fill = "lightblue", fill_alpha = 0.9) +
  tm_shape(rios_menores) + tm_lines(col = "blue", lwd = 0.4) +
  tm_shape(rios_principais) + tm_lines(col = "darkblue", lwd = 1.2) +

  tm_add_legend(type = "lines", fill = "darkblue", lwd = 1.2, labels = "Main rivers") +
  tm_add_legend(type = "lines", fill = "blue", lwd = 0.4, labels = "Minor rivers") +
  tm_add_legend(type = "polygons", fill = "lightblue", labels = "Lakes") +

  tm_title("Mozambique — Altitude and Hydrography", size = 1.4, position = c("center","top")) +
  tm_layout(legend.outside = TRUE, legend.outside.position = "right",
            frame = FALSE, inner.margins = c(0.05, 0.25, 0.05, 0.05)) +
  tm_scalebar(position = c("left","bottom")) +
  tm_compass(type = "8star", position = c("left","top"), size = 2) +
  tm_credits("Source: GADM, Natural Earth, Geodata (UCDavis)\nProjection: EPSG:4326 (WGS 84)\nAuthor: Inacio Samuel Cuna", position = c("right","bottom"), size = 0.6)

mapa
  #######################################################################################################################################
